<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrivateGPT - å¡é€š AI çŸ¥è¯†åº“</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script>
    // Tailwind é…ç½®ï¼ˆå¡é€šå¯çˆ±è‰²å½©ä½“ç³»ï¼‰
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                colors: {
                    // é©¬å¡é¾™å¯çˆ±é…è‰²
                    primary: '#FF6B8B', // èœœæ¡ƒç²‰ï¼ˆä¸»è‰²ï¼‰
                    secondary: '#82C3EC', // å¤©ç©ºè“ï¼ˆè¾…åŠ©è‰²ï¼‰
                    accent: '#FFD166', // å¥¶æ²¹é»„ï¼ˆå¼ºè°ƒè‰²ï¼‰
                    mint: '#93E9BE', // è–„è·ç»¿ï¼ˆç‚¹ç¼€è‰²ï¼‰
                    dark: '#F9F7F7', // æµ…ç°ç™½ï¼ˆæ·±è‰²æ¨¡å¼åº•ï¼‰
                    darker: '#FFFFFF', // çº¯ç™½ï¼ˆæ·±è‰²æ¨¡å¼åˆ†å±‚ï¼‰
                    neutral: '#F0EEF8', // æ·¡ç´«ç°ï¼ˆç»„ä»¶èƒŒæ™¯ï¼‰
                    'neutral-light': '#E8E5F8', // æµ…ç´«ç°ï¼ˆhoverçŠ¶æ€ï¼‰
                    'text-primary': '#4A4A68', // æ·±ç´«ç°ï¼ˆä¸»æ–‡æœ¬ï¼‰
                    'text-secondary': '#9492A6', // æµ…ç´«ç°ï¼ˆæ¬¡æ–‡æœ¬ï¼‰
                    // Dark æ¨¡å¼ï¼ˆæŸ”å’Œæš—è‰²è°ƒï¼‰
                    'dark-bg': '#2D2B40',
                    'dark-neutral': '#3D3B56',
                    'dark-text-primary': '#F9F7F7',
                    'dark-text-secondary': '#C0BED9',
                },
                fontFamily: {
                    sans: ['Comic Neue', 'system-ui', 'sans-serif'], // å¡é€šå­—ä½“
                },
                boxShadow: {
                    'cute': '0 4px 12px rgba(255, 107, 139, 0.15)', // æŸ”å’Œå¯çˆ±é˜´å½±
                    'cute-hover': '0 6px 18px rgba(255, 107, 139, 0.25)',
                    'float': '0 8px 20px rgba(130, 195, 236, 0.2)', // æ‚¬æµ®é˜´å½±
                },
                animation: {
                    'bounce-slow': 'bounce 3s infinite', // æ…¢é€Ÿå¼¹è·³
                    'wiggle': 'wiggle 1s ease-in-out infinite', // æ‘‡æ‘†åŠ¨ç”»
                    'float': 'float 3s ease-in-out infinite', // æ¼‚æµ®åŠ¨ç”»
                },
                keyframes: {
                    wiggle: {
                        '0%, 100%': { transform: 'rotate(-2deg)' },
                        '50%': { transform: 'rotate(2deg)' },
                    },
                    float: {
                        '0%, 100%': { transform: 'translateY(0)' },
                        '50%': { transform: 'translateY(-8px)' },
                    }
                },
                borderRadius: {
                    'xl': '1rem',
                    '2xl': '1.5rem',
                    '3xl': '2rem',
                    'pill': '9999px', // èƒ¶å›Šåœ†è§’
                }
            }
        }
    }
</script>
<style type="text/tailwindcss">
    @layer utilities {
        .content-auto {
            content-visibility: auto;
        }
        .scrollbar-hide {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        /* å¡é€šèŠå¤©æ°”æ³¡ */
        .chat-bubble-user {
            @apply bg-gradient-to-r from-primary/90 to-primary text-white rounded-2xl rounded-tr-none p-4 max-w-[75%] ml-auto shadow-cute transition-all duration-300 hover:shadow-cute-hover relative overflow-hidden;
        }
        .chat-bubble-user::before {
            content: '';
            @apply absolute -bottom-2 -right-2 w-8 h-8 bg-primary rounded-full opacity-50;
        }
        .chat-bubble-ai {
            @apply bg-neutral border border-secondary/30 text-text-primary rounded-2xl rounded-tl-none p-4 max-w-[75%] mr-auto shadow-cute transition-all duration-300 hover:shadow-cute-hover relative overflow-hidden;
        }
        .chat-bubble-ai::before {
            content: '';
            @apply absolute -bottom-2 -left-2 w-8 h-8 bg-secondary rounded-full opacity-30;
        }
        /* å¡é€šæŒ‰é’® */
        .btn-primary {
            @apply bg-gradient-to-r from-primary to-secondary text-white font-medium py-2.5 px-5 rounded-pill transition-all duration-300 flex items-center gap-2 shadow-cute hover:shadow-cute-hover hover:scale-105 relative overflow-hidden;
        }
        .btn-primary::after {
            content: '';
            @apply absolute inset-0 bg-white/10 opacity-0 transition-opacity duration-300;
        }
        .btn-primary:hover::after {
            @apply opacity-100;
        }
        .btn-secondary {
            @apply bg-white border border-primary/20 text-text-primary font-medium py-2.5 px-5 rounded-pill transition-all duration-300 flex items-center gap-2 hover:bg-neutral-light hover:shadow-cute relative overflow-hidden;
        }
        .btn-secondary::before {
            content: '';
            @apply absolute top-0 left-0 w-1.5 h-full bg-accent rounded-l-full;
        }
        /* å¡é€šå¡ç‰‡ */
        .card {
            @apply bg-white rounded-2xl p-4 hover:border-primary/30 transition-all duration-300 cursor-pointer shadow-cute hover:shadow-cute-hover hover:scale-[1.02] relative overflow-hidden;
        }
        .card::after {
            content: '';
            @apply absolute inset-0 bg-gradient-to-br from-accent/5 to-transparent opacity-0 transition-opacity duration-300;
        }
        .card:hover::after {
            @apply opacity-100;
        }
        /* å¡é€šè¾“å…¥æ¡† */
        .input-field {
            @apply w-full bg-white border border-primary/20 rounded-2xl p-4 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-300 text-text-primary relative shadow-sm;
        }
        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            @apply w-full h-2 bg-neutral rounded-full overflow-hidden mt-2;
        }
        .progress-fill {
            @apply h-full bg-gradient-to-r from-accent to-primary rounded-full transition-all duration-300;
        }
        /* Dark æ¨¡å¼é€‚é… */
        .dark {
            @apply bg-dark-bg text-dark-text-primary;
        }
        .dark .chat-bubble-ai {
            @apply bg-dark-neutral text-dark-text-primary border-secondary/40;
        }
        .dark .chat-bubble-ai::before {
            @apply bg-secondary/40;
        }
        .dark .btn-secondary {
            @apply bg-dark-neutral text-dark-text-primary border-primary/30 hover:bg-dark-neutral/80;
        }
        .dark .card {
            @apply bg-dark-neutral text-dark-text-primary border-primary/30;
        }
        .dark .input-field {
            @apply bg-dark-neutral text-dark-text-primary border-primary/30 focus:border-primary;
        }
        .dark header, .dark footer {
            @apply bg-dark-neutral border-primary/20;
        }
        .dark .text-text-secondary {
            @apply text-dark-text-secondary;
        }
        .dark .progress-bar {
            @apply bg-dark-neutral/50;
        }
        /* å¡é€šè£…é¥°å…ƒç´  */
        .cute-dot {
            @apply w-2 h-2 rounded-full bg-accent inline-block;
        }
        .cute-corner {
            @apply absolute top-0 right-0 w-12 h-12;
        }
        .cute-corner::before {
            content: '';
            @apply absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-accent rounded-tr-2xl;
        }
    }
</style>
<!-- å¼•å…¥å¡é€šå­—ä½“ -->
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-darker text-text-primary font-sans h-screen flex flex-col overflow-hidden">
<!-- èƒŒæ™¯å¯çˆ±è£…é¥° -->
<div class="fixed inset-0 z-0 opacity-5 pointer-events-none">
    <div class="absolute top-10 left-10 w-20 h-20 rounded-full bg-accent/20 animate-float"></div>
    <div class="absolute bottom-20 right-10 w-16 h-16 rounded-full bg-primary/20 animate-float" style="animation-delay: 1s;"></div>
    <div class="absolute top-1/2 left-1/4 w-12 h-12 rounded-full bg-secondary/20 animate-float" style="animation-delay: 2s;"></div>
</div>

<!-- é¡¶éƒ¨å¯¼èˆªæ ï¼ˆå¡é€šå¯çˆ±é£æ ¼ï¼‰ -->
<header class="border-b border-primary/10 bg-white/90 backdrop-blur-md py-4 px-5 flex items-center justify-between sticky top-0 z-50 relative overflow-hidden">
    <div class="flex items-center gap-3 z-10">
        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center animate-wiggle">
            <i class="fa fa-robot text-white text-lg"></i>
        </div>
        <h1 class="text-xl font-bold text-text-primary">
            <span class="text-primary">Private</span>
            <span class="text-secondary">GPT</span>
        </h1>
    </div>
    <div class="flex items-center gap-3 z-10">
        <button id="modelBtn" class="btn-secondary text-sm px-4 py-2">
            <span class="font-bold text-xs">ğŸ¦™ llama3.1</span>
        </button>
        <button id="uploadBtn" class="btn-secondary text-sm px-4 py-2">
            <i class="fa fa-cloud-upload text-xs text-accent"></i>
            <span class="font-bold text-xs">ä¸Šä¼ </span>
        </button>
        <button id="themeBtn" class="btn-secondary w-10 h-10 p-0 flex items-center justify-center rounded-full">
            <i class="fa fa-moon-o text-sm text-primary"></i>
        </button>
    </div>
    <!-- å¯çˆ±è§’è½è£…é¥° -->
    <div class="cute-corner"></div>
</header>

<!-- ä¸»å†…å®¹åŒº -->
<main class="flex-1 flex overflow-hidden relative z-10">
    <!-- å·¦ä¾§ä¾§è¾¹æ  -->
    <aside class="w-60 border-r border-primary/10 bg-white/50 p-4 hidden md:block overflow-y-auto scrollbar-hide">
        <div class="mb-8">
            <h2 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-4 flex items-center gap-2">
                <span class="cute-dot"></span>
                <span>æˆ‘çš„èŠå¤©</span>
            </h2>
            <button class="w-full btn-secondary text-left mb-4 text-sm">
                <i class="fa fa-plus-circle text-xs mr-2 text-accent"></i>
                <span class="font-bold">æ–°å¯¹è¯ âœ¨</span>
            </button>
            <div class="space-y-3">
                <div class="card">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa fa-file-text-o text-primary text-lg"></i>
                        <p class="text-sm font-bold truncate">æŠ€æœ¯æ–‡æ¡£æ€»ç»“</p>
                    </div>
                    <p class="text-xs text-text-secondary mt-1 flex items-center gap-1">
                        <i class="fa fa-clock-o text-accent text-[10px]"></i>
                        <span>ä»Šå¤© 14:30</span>
                    </p>
                </div>
                <div class="card">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa fa-code text-secondary text-lg"></i>
                        <p class="text-sm font-bold truncate">Python ç¼–ç¨‹é—®é¢˜</p>
                    </div>
                    <p class="text-xs text-text-secondary mt-1 flex items-center gap-1">
                        <i class="fa fa-clock-o text-accent text-[10px]"></i>
                        <span>ä»Šå¤© 10:15</span>
                    </p>
                </div>
                <div class="card">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa fa-search text-accent text-lg"></i>
                        <p class="text-sm font-bold truncate">çŸ¥è¯†åº“æŸ¥è¯¢æµ‹è¯•</p>
                    </div>
                    <p class="text-xs text-text-secondary mt-1 flex items-center gap-1">
                        <i class="fa fa-clock-o text-accent text-[10px]"></i>
                        <span>æ˜¨å¤© 16:45</span>
                    </p>
                </div>
            </div>
        </div>
        <div>
            <h2 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-4 flex items-center gap-2">
                <span class="cute-dot"></span>
                <span>æˆ‘çš„çŸ¥è¯†åº“</span>
            </h2>
            <div id="knowledgeBaseList" class="space-y-3">
                <!-- åŠ¨æ€æ¸²æŸ“çŸ¥è¯†åº“æ–‡ä»¶ -->
                <div class="card flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                            <i class="fa fa-file-pdf-o text-primary text-sm"></i>
                        </div>
                        <span class="text-sm font-bold truncate">æŠ€æœ¯æ–‡æ¡£.pdf</span>
                    </div>
                    <button class="text-text-secondary hover:text-primary transition-colors p-1 rounded-full hover:bg-primary/10 delete-file-btn" data-doc-id="c202d5e6-7b69-4869-81cc-dd574ee8ee11">
                        <i class="fa fa-trash-o text-xs"></i>
                    </button>
                </div>
                <div class="card flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-secondary/10 flex items-center justify-center">
                            <i class="fa fa-file-word-o text-secondary text-sm"></i>
                        </div>
                        <span class="text-sm font-bold truncate">äº§å“è¯´æ˜ä¹¦.docx</span>
                    </div>
                    <button class="text-text-secondary hover:text-primary transition-colors p-1 rounded-full hover:bg-primary/10 delete-file-btn" data-doc-id="d303e6f7-8c70-5970-92dd-ee685ff9ff22">
                        <i class="fa fa-trash-o text-xs"></i>
                    </button>
                </div>
            </div>
        </div>
    </aside>

    <!-- ä¸­é—´èŠå¤©åŒº -->
    <section class="flex-1 flex flex-col overflow-hidden">
        <div id="chatContainer" class="flex-1 p-5 md:p-8 overflow-y-auto scrollbar-hide space-y-6 relative">
            <!-- æ¬¢è¿æ¶ˆæ¯ -->
            <div class="chat-bubble-ai">
                <div class="flex items-start gap-4">
                    <div class="w-8 h-8 rounded-full bg-secondary/20 flex items-center justify-center animate-bounce-slow">
                        <i class="fa fa-robot text-secondary text-sm"></i>
                    </div>
                    <div class="space-y-2">
                        <p class="text-sm font-bold">ä½ å¥½å‘€ï¼ğŸ˜Š æˆ‘æ˜¯ PrivateGPT</p>
                        <p class="text-sm text-text-secondary">æˆ‘æ˜¯åŸºäºæœ¬åœ°å¤§æ¨¡å‹çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥å›ç­”ä½ çš„é—®é¢˜ï¼Œä¹Ÿèƒ½å¸®ä½ æŸ¥è¯¢ä¸Šä¼ çš„çŸ¥è¯†åº“æ–‡ä»¶å“¦ï½</p>
                    </div>
                </div>
            </div>

            <!-- ç¤ºä¾‹å¯¹è¯ -->
            <div class="chat-bubble-user">
                <div class="flex items-start gap-4">
                    <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center">
                        <i class="fa fa-user text-primary text-sm"></i>
                    </div>
                    <p class="text-sm font-bold">ä»€ä¹ˆæ˜¯ PrivateGPTï¼Ÿ</p>
                </div>
            </div>
            <div class="chat-bubble-ai">
                <div class="flex items-start gap-4">
                    <div class="w-8 h-8 rounded-full bg-secondary/20 flex items-center justify-center animate-bounce-slow">
                        <i class="fa fa-robot text-secondary text-sm"></i>
                    </div>
                    <p class="text-sm">PrivateGPT æ˜¯å¼€æºçš„æœ¬åœ°å¤§æ¨¡å‹é—®ç­”ç³»ç»Ÿ ğŸš€ï¼Œæ”¯æŒç¦»çº¿éƒ¨ç½²å’ŒçŸ¥è¯†åº“ç§æœ‰åŒ–ç®¡ç†ï¼Œæ— éœ€è”ç½‘å°±èƒ½ä¿æŠ¤ä½ çš„æ•°æ®éšç§ï¼Œè¿˜èƒ½é€šè¿‡ GPU åŠ é€Ÿè®©å›ç­”æ›´å¿«å“¦ï½</p>
                </div>
            </div>
        </div>

        <!-- è¾“å…¥åŒº -->
        <div class="border-t border-primary/10 bg-white/90 p-4 md:p-5 relative">
            <form id="chatForm" class="flex flex-col gap-4 relative z-10">
                <div class="relative">
                    <textarea 
                        id="userInput"
                        class="input-field resize-none min-h-[80px] pr-12"
                        placeholder="æƒ³é—®ä»€ä¹ˆå‘€ï¼ŸğŸ˜œ"
                    ></textarea>
                    <button type="button" class="absolute right-4 bottom-4 text-text-secondary hover:text-primary transition-colors p-1 rounded-full hover:bg-primary/10">
                        <i class="fa fa-paperclip text-sm text-accent"></i>
                    </button>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="btn-primary font-bold">
                        <i class="fa fa-paper-plane text-sm"></i>
                        <span>å‘é€æ¶ˆæ¯ ğŸ’¬</span>
                    </button>
                </div>
            </form>
        </div>
    </section>

    <!-- å³ä¾§é…ç½®é¢æ¿ -->
    <aside id="configPanel" class="w-72 border-l border-primary/10 bg-white/50 p-5 hidden lg:block overflow-y-auto scrollbar-hide">
        <div class="space-y-8">
            <div class="card">
                <h2 class="text-lg font-bold mb-5 flex items-center gap-2">
                    <i class="fa fa-cog text-primary"></i>
                    <span>æ¨¡å‹é…ç½® ğŸ› ï¸</span>
                </h2>
                <div class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-text-secondary mb-2">é€‰æ‹©å¯çˆ±æ¨¡å‹</label>
                        <select id="modelSelect" class="input-field text-sm p-3">
                            <option selected>llama3.2:3b</option>
                            <option>ğŸ± qwen:7b-chatï¼ˆCPUï¼‰</option>
                            <option>ğŸ¶ mistral:7b-instructï¼ˆGPUï¼‰</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-text-secondary mb-2">åˆ›æ„æ¸©åº¦ ğŸŒ¡ï¸</label>
                        <input type="range" min="0" max="1" step="0.1" value="0.1" class="w-full accent-primary" id="temperatureSlider">
                        <div class="flex justify-between text-xs text-text-secondary mt-2">
                            <span class="font-bold">è¶…æ­£ç»</span>
                            <span id="temperatureValue" class="text-accent font-bold">0.1</span>
                            <span class="font-bold">è¶…è„‘æ´</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-text-secondary mb-2">å›ç­”é•¿åº¦ ğŸ“</label>
                        <select id="maxTokensSelect" class="input-field text-sm p-3">
                            <option>256ï¼ˆç®€çŸ­ï¼‰</option>
                            <option selected>512ï¼ˆé€‚ä¸­ï¼‰</option>
                            <option>1024ï¼ˆè¯¦ç»†ï¼‰</option>
                            <option>2048ï¼ˆè¶…é•¿ï¼‰</option>
                        </select>
                    </div>
                    <button class="w-full btn-primary text-sm font-bold">
                        <i class="fa fa-save text-xs"></i>
                        <span>ä¿å­˜é…ç½® ğŸ’¾</span>
                    </button>
                </div>
            </div>
            <div class="card">
                <h2 class="text-lg font-bold mb-5 flex items-center gap-2">
                    <i class="fa fa-comment text-secondary"></i>
                    <span>ç³»ç»Ÿæç¤ºè¯ ğŸ“</span>
                </h2>
                <textarea id="systemPrompt" class="input-field h-32 text-sm" placeholder="è¾“å…¥ç³»ç»Ÿæç¤ºè¯...">ä½ æ˜¯ä¸€ä¸ªå¯çˆ±ã€å‹å¥½ã€å……æ»¡ç«¥è¶£çš„AIåŠ©æ‰‹ï¼Œå›ç­”è¦è½»æ¾æœ‰è¶£ï¼Œå¤šç”¨emojiå’Œå¯çˆ±çš„è¯­æ°”ï¼Œå§‹ç»ˆä¿æŒè€å¿ƒå’Œçƒ­æƒ…ã€‚</textarea>
                <button class="w-full btn-primary text-sm font-bold mt-4">
                    <i class="fa fa-save text-xs"></i>
                    <span>æ›´æ–°æç¤ºè¯ âœ¨</span>
                </button>
            </div>
            <div class="card">
                <h2 class="text-lg font-bold mb-5 flex items-center gap-2">
                    <i class="fa fa-heart text-accent"></i>
                    <span>æœåŠ¡çŠ¶æ€ ğŸ“Š</span>
                </h2>
                <div class="space-y-4 text-sm">
                    <div class="flex justify-between items-center">
                        <span class="text-text-secondary">æ¨¡å‹çŠ¶æ€ï¼š</span>
                        <span class="text-green-500 flex items-center gap-1 font-bold">
                            <i class="fa fa-check-circle"></i> å¿«ä¹è¿è¡Œä¸­
                        </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-text-secondary">GPU åŠ é€Ÿï¼š</span>
                        <span id="gpuStatus" class="text-green-500 flex items-center gap-1 font-bold">
                            <i class="fa fa-check-circle"></i> å·²å¯ç”¨ ğŸš€
                        </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-text-secondary">æ˜¾å­˜å ç”¨ï¼š</span>
                        <span class="font-bold text-accent">2.8 GB / 8 GB</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-text-secondary">å“åº”é€Ÿåº¦ï¼š</span>
                        <span class="font-bold text-primary">è¶…å¿« âš¡</span>
                    </div>
                </div>
            </div>
        </div>
    </aside>
</main>

<!-- åº•éƒ¨çŠ¶æ€æ  -->
<footer class="border-t border-primary/10 bg-white/90 py-3 px-5 text-xs text-text-secondary flex justify-between items-center relative z-50">
    <div class="font-bold">PrivateGPT Â· æœ¬åœ°éƒ¨ç½² Â· æ•°æ®ç§æœ‰åŒ– ğŸ›¡ï¸</div>
    <div class="flex items-center gap-4">
        <span class="flex items-center gap-1 font-bold"><i class="fa fa-gpu text-accent"></i> RTX 3060</span>
        <span class="flex items-center gap-1 font-bold"><i class="fa fa-clock-o text-accent"></i> å“åº”æ—¶é—´ï¼š0.8s</span>
    </div>
</footer>

<!-- ä¸Šä¼ æ–‡ä»¶æ¨¡æ€æ¡† -->
<div id="uploadModal" class="fixed inset-0 bg-black/20 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-3xl w-full max-w-md p-6 space-y-6 shadow-float relative overflow-hidden">
        <!-- æ¨¡æ€æ¡†å¯çˆ±è£…é¥° -->
        <div class="absolute top-0 left-0 w-full h-3 bg-gradient-to-r from-primary to-secondary"></div>
        
        <div class="flex justify-between items-center relative z-10">
            <h3 class="text-xl font-bold flex items-center gap-2">
                <i class="fa fa-cloud-upload text-primary"></i>
                <span>ä¸Šä¼ çŸ¥è¯†åº“æ–‡ä»¶ ğŸ“¤</span>
            </h3>
            <button id="closeModalBtn" class="text-text-secondary hover:text-primary transition-colors p-2 rounded-full hover:bg-primary/10">
                <i class="fa fa-times text-accent"></i>
            </button>
        </div>
        
        <div class="border-2 border-dashed border-primary/30 rounded-2xl p-8 text-center" id="dropArea">
            <div class="w-20 h-20 rounded-full bg-secondary/10 flex items-center justify-center mx-auto mb-4 animate-float">
                <i class="fa fa-file-text-o text-secondary text-3xl"></i>
            </div>
            <p class="text-sm font-bold mb-2">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ ğŸ“‚</p>
            <p class="text-xs text-text-secondary">æ”¯æŒ PDFã€Wordã€TXTã€Markdownï¼ˆå•ä¸ªæ–‡ä»¶æœ€å¤§ 100MBï¼‰</p>
            <input type="file" id="fileInput" class="hidden" multiple accept=".pdf,.docx,.doc,.txt,.md">
            <button id="selectFileBtn" class="btn-primary mt-6 text-sm font-bold">
                <i class="fa fa-file text-xs"></i>
                <span>é€‰æ‹©æ–‡ä»¶</span>
            </button>
        </div>
        
        <div id="fileList" class="space-y-3 hidden relative z-10">
            <h4 class="text-xs font-bold text-text-secondary flex items-center gap-2">
                <span class="cute-dot"></span>
                <span>å¾…ä¸Šä¼ æ–‡ä»¶</span>
            </h4>
            <div id="selectedFilesContainer" class="space-y-2">
                <!-- åŠ¨æ€æ¸²æŸ“é€‰ä¸­çš„æ–‡ä»¶ -->
            </div>
            <!-- ä¸Šä¼ è¿›åº¦æ¡ -->
            <div id="uploadProgressContainer" class="hidden">
                <p class="text-xs text-text-secondary font-bold mt-2">ä¸Šä¼ è¿›åº¦ ğŸ“ˆ</p>
                <div class="progress-bar">
                    <div id="uploadProgressBar" class="progress-fill" style="width: 0%"></div>
                </div>
                <p id="uploadProgressText" class="text-xs text-text-secondary mt-1 text-center">0%</p>
            </div>
        </div>
        
        <div class="flex justify-end gap-3 relative z-10">
            <button id="cancelUploadBtn" class="btn-secondary text-sm font-bold">å–æ¶ˆ âŒ</button>
            <button id="confirmUploadBtn" class="btn-primary text-sm font-bold">
                <i class="fa fa-upload text-xs"></i>
                <span>å¼€å§‹ä¸Šä¼  ğŸš€</span>
            </button>
        </div>
    </div>
</div>

<script>
    // å…¨å±€å˜é‡
    let selectedDocIds = []; // ç§»é™¤ç¡¬ç¼–ç çš„æ— æ•ˆ ID
    let currentUploadFile = null;

    // DOM å…ƒç´ è·å–
    const chatForm = document.getElementById('chatForm');
    const userInput = document.getElementById('userInput');
    const chatContainer = document.getElementById('chatContainer');
    const modelBtn = document.getElementById('modelBtn');
    const configPanel = document.getElementById('configPanel');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadModal = document.getElementById('uploadModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const cancelUploadBtn = document.getElementById('cancelUploadBtn');
    const selectFileBtn = document.getElementById('selectFileBtn');
    const fileInput = document.getElementById('fileInput');
    const dropArea = document.getElementById('dropArea');
    const fileList = document.getElementById('fileList');
    const selectedFilesContainer = document.getElementById('selectedFilesContainer');
    const uploadProgressContainer = document.getElementById('uploadProgressContainer');
    const uploadProgressBar = document.getElementById('uploadProgressBar');
    const uploadProgressText = document.getElementById('uploadProgressText');
    const confirmUploadBtn = document.getElementById('confirmUploadBtn');
    const temperatureSlider = document.getElementById('temperatureSlider');
    const temperatureValue = document.getElementById('temperatureValue');
    const themeBtn = document.getElementById('themeBtn');
    const knowledgeBaseList = document.getElementById('knowledgeBaseList');
    
    // æ–°å¢ï¼šæ¨¡å‹é…ç½®ç›¸å…³å…ƒç´ 
    const modelSelect = document.getElementById('modelSelect');
    const maxTokensSelect = document.getElementById('maxTokensSelect');
    const systemPrompt = document.getElementById('systemPrompt');
    const gpuStatus = document.getElementById('gpuStatus');

    // æ¸©åº¦æ»‘å—å®æ—¶æ›´æ–°
    temperatureSlider.addEventListener('input', () => {
        temperatureValue.textContent = temperatureSlider.value;
    });

    // æ¨¡å‹æŒ‰é’®ï¼šåˆ‡æ¢é…ç½®é¢æ¿æ˜¾ç¤º
    modelBtn.addEventListener('click', () => {
        configPanel.classList.toggle('hidden');
    });

    // ä¸Šä¼ æŒ‰é’®ï¼šæ‰“å¼€æ¨¡æ€æ¡†
    uploadBtn.addEventListener('click', () => {
        uploadModal.classList.remove('hidden');
        // é‡ç½®ä¸Šä¼ çŠ¶æ€
        resetUploadState();
    });

    // å…³é—­æ¨¡æ€æ¡†
    [closeModalBtn, cancelUploadBtn].forEach(btn => {
        btn.addEventListener('click', () => {
            uploadModal.classList.add('hidden');
            resetUploadState();
        });
    });

    // é‡ç½®ä¸Šä¼ çŠ¶æ€
    function resetUploadState() {
        fileList.classList.add('hidden');
        uploadProgressContainer.classList.add('hidden');
        uploadProgressBar.style.width = '0%';
        uploadProgressText.textContent = '0%';
        selectedFilesContainer.innerHTML = '';
        fileInput.value = '';
        currentUploadFile = null;
    }

    // é€‰æ‹©æ–‡ä»¶æŒ‰é’®
    selectFileBtn.addEventListener('click', () => {
        fileInput.click();
    });

    // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
    fileInput.addEventListener('change', (e) => {
        handleFileSelection(e.target.files);
    });

    // æ‹–æ‹½ä¸Šä¼ 
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
        dropArea.classList.add('border-primary');
        dropArea.classList.add('bg-primary/5');
    }

    function unhighlight() {
        dropArea.classList.remove('border-primary');
        dropArea.classList.remove('bg-primary/5');
    }

    dropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files.length > 0) {
            handleFileSelection(files);
        }
    }

    // å¤„ç†æ–‡ä»¶é€‰æ‹©
    function handleFileSelection(files) {
        if (files.length === 0) return;
        
        fileList.classList.remove('hidden');
        selectedFilesContainer.innerHTML = '';
        
        // åªå¤„ç†ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆå¯æ‰©å±•ä¸ºå¤šæ–‡ä»¶ï¼‰
        const file = files[0];
        currentUploadFile = file;
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        const fileSize = formatFileSize(file.size);
        
        // åˆ›å»ºæ–‡ä»¶é¡¹
        const fileItem = document.createElement('div');
        fileItem.className = 'flex items-center justify-between p-3 bg-neutral rounded-2xl';
        fileItem.innerHTML = `
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                    <i class="fa ${getFileIcon(file.name)} text-primary text-xs"></i>
                </div>
                <span class="text-sm font-bold truncate">${file.name}</span>
            </div>
            <span class="text-xs text-text-secondary font-bold">${fileSize}</span>
        `;
        
        selectedFilesContainer.appendChild(fileItem);
    }

    // è·å–æ–‡ä»¶å›¾æ ‡
    function getFileIcon(fileName) {
        const ext = fileName.split('.').pop().toLowerCase();
        switch (ext) {
            case 'pdf': return 'fa-file-pdf-o';
            case 'docx':
            case 'doc': return 'fa-file-word-o';
            case 'txt': return 'fa-file-text-o';
            case 'md': return 'fa-file-code-o';
            default: return 'fa-file-o';
        }
    }

    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // ä¸Šä¼ ç¡®è®¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    function fetchWithProgress(url, options, onProgress) {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            xhr.open(options.method || 'GET', url);
            
            // è®¾ç½®è¯·æ±‚å¤´ï¼ˆå…¼å®¹ FormDataï¼Œä¸æ‰‹åŠ¨è®¾ç½® Content-Typeï¼‰
            if (options.headers) {
                Object.keys(options.headers).forEach(key => {
                    xhr.setRequestHeader(key, options.headers[key]);
                });
            }
            
            // ä¿®å¤ï¼šè¿›åº¦å›è°ƒç»‘å®šï¼ˆæ­£ç¡®æ¥æ”¶ onProgress å‚æ•°ï¼‰
            if (onProgress && xhr.upload) {
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percent = (e.loaded / e.total) * 100;
                        onProgress(Math.round(percent));
                    }
                });
            }
            
            // å®Œæˆå›è°ƒï¼šä¿®å¤ Response æ„é€ ï¼Œå…¼å®¹ JSON è§£æ
            xhr.addEventListener('load', () => {
                const headers = new Headers();
                const headerStr = xhr.getAllResponseHeaders();
                if (headerStr) {
                    headerStr.split('\n').forEach(line => {
                        const [key, ...values] = line.trim().split(':');
                        if (key) headers.append(key, values.join(':').trim());
                    });
                }

                const response = new Response(xhr.responseText, {
                    status: xhr.status,
                    statusText: xhr.statusText,
                    headers: headers
                });
                
                if (xhr.status >= 200 && xhr.status < 300) {
                    resolve(response);
                } else {
                    // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                    response.text().then(errorText => {
                        reject(new Error(`è¯·æ±‚å¤±è´¥ (${xhr.status}): ${errorText || xhr.statusText}`));
                    }).catch(() => {
                        reject(new Error(`è¯·æ±‚å¤±è´¥: ${xhr.status} ${xhr.statusText}`));
                    });
                }
            });
            
            xhr.addEventListener('error', () => reject(new Error('Network error occurred')));
            xhr.addEventListener('abort', () => reject(new Error('Request aborted')));
            xhr.send(options.body);
        });
    }

    // ä¿®å¤ï¼šä¸Šä¼ ç¡®è®¤æŒ‰é’®é€»è¾‘ï¼ˆå‚æ•°ä¼ é€’ + doc_id è§£æï¼‰
    confirmUploadBtn.addEventListener('click', async () => {
        if (!currentUploadFile) {
            alert('è¯·å…ˆé€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶å“¦ ğŸ˜œ');
            return;
        }

        confirmUploadBtn.disabled = true;
        confirmUploadBtn.innerHTML = '<i class="fa fa-spinner fa-spin text-xs"></i><span>ä¸Šä¼ ä¸­...</span>';
        uploadProgressContainer.classList.remove('hidden');
        
        try {
            const formData = new FormData();
            formData.append("file", currentUploadFile);
            console.log("1111", formData);

            // ä½¿ç”¨æ­£ç¡®çš„è¿›åº¦å›è°ƒä¼ é€’æ–¹å¼
            const response = await fetchWithProgress(
                "http://localhost:8001/v1/ingest/file",
                { method: "POST", body: formData },
                updateUploadProgress
            );
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`ä¸Šä¼ å¤±è´¥ï¼š${response.status} - ${errorText}`);
            }
            
            // æ­£ç¡®è§£æJSONå“åº”
            const result = await response.json();
            const docItem = result.data?.[0];
            if (!docItem || !docItem.doc_id) {
                throw new Error("æœªè·å–åˆ°æœ‰æ•ˆæ–‡æ¡£ID");
            }
            const docId = docItem.doc_id;
            console.log("æ–‡ä»¶æ‘„å…¥æˆåŠŸï¼Œæ–‡æ¡£IDï¼š", docId);
            
            updateUploadProgress(100);
            if (!selectedDocIds.includes(docId)) {
                selectedDocIds.push(docId);
            }
            // ä¿®å¤å˜é‡åé”™è¯¯
            addFileToKnowledgeBase(currentUploadFile.name, docId);
            showSuccessMessage(`æ–‡ä»¶ "${currentUploadFile.name}" ä¸Šä¼ æˆåŠŸå•¦ âœ¨`);
            
            setTimeout(() => {
                uploadModal.classList.add('hidden');
                resetUploadState();
            }, 1500);

        } catch (error) {
            console.error('æ–‡ä»¶ä¸Šä¼ é”™è¯¯ï¼š', error);
            alert(`å“å‘€ï¼Œä¸Šä¼ å¤±è´¥äº† ğŸ˜¥ï¼š${error.message}`);
            updateUploadProgress(0);
        } finally {
            confirmUploadBtn.disabled = false;
            confirmUploadBtn.innerHTML = '<i class="fa fa-upload text-xs"></i><span>å¼€å§‹ä¸Šä¼  ğŸš€</span>';
        }
    });

    // æ›´æ–°ä¸Šä¼ è¿›åº¦
    function updateUploadProgress(percent) {
        uploadProgressBar.style.width = `${percent}%`;
        uploadProgressText.textContent = `${percent}%`;
    }

    // æ·»åŠ æ–‡ä»¶åˆ°çŸ¥è¯†åº“åˆ—è¡¨
    function addFileToKnowledgeBase(fileName, docId) {
        const fileIcon = getFileIcon(fileName);
        const fileColor = fileIcon === 'fa-file-pdf-o' ? 'primary' : 'secondary';
        
        const fileItem = document.createElement('div');
        fileItem.className = 'card flex items-center justify-between';
        fileItem.innerHTML = `
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-${fileColor}/10 flex items-center justify-center">
                    <i class="fa ${fileIcon} text-${fileColor} text-sm"></i>
                </div>
                <span class="text-sm font-bold truncate">${fileName}</span>
            </div>
            <button class="text-text-secondary hover:text-primary transition-colors p-1 rounded-full hover:bg-primary/10 delete-file-btn" data-doc-id="${docId}">
                <i class="fa fa-trash-o text-xs"></i>
            </button>
        `;
        
        knowledgeBaseList.appendChild(fileItem);
        
        // æ·»åŠ åˆ é™¤äº‹ä»¶ç›‘å¬
        fileItem.querySelector('.delete-file-btn').addEventListener('click', function() {
            deleteFileFromKnowledgeBase(this, docId);
        });
    }

    // ä»çŸ¥è¯†åº“åˆ é™¤æ–‡ä»¶
    function deleteFileFromKnowledgeBase(button, docId) {
        if (confirm(`ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼ŸğŸ˜¢`)) {
            // è°ƒç”¨åç«¯åˆ é™¤æ¥å£
            fetch(`http://localhost:8001/v1/ingest/${docId}`, {
                method: "DELETE",
                // å¯ä»¥æ·»åŠ é€‚å½“çš„headersï¼Œä½†DELETEè¯·æ±‚é€šå¸¸ä¸éœ€è¦Content-Type
            }).then(res => {
                if (!res.ok) throw new Error("åˆ é™¤å¤±è´¥");
                // å‰ç«¯DOMæ“ä½œ
                const fileItem = button.closest('.card');
                fileItem.classList.add('opacity-0');
                setTimeout(() => fileItem.remove(), 300);
                selectedDocIds = selectedDocIds.filter(id => id !== docId);
                showSuccessMessage('æ–‡ä»¶å·²æˆåŠŸåˆ é™¤ ğŸ—‘ï¸');
            }).catch(err => {
                console.error("åˆ é™¤æ–‡ä»¶å¤±è´¥ï¼š", err);
                alert("åˆ é™¤å¤±è´¥ï¼š" + err.message);
            });
        }
    }

    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯åˆ°èŠå¤©æ¡†
    function showSuccessMessage(message) {
        const successMessageHtml = `
            <div class="chat-bubble-ai">
                <div class="flex items-start gap-4">
                    <div class="w-8 h-8 rounded-full bg-mint/20 flex items-center justify-center animate-bounce-slow">
                        <i class="fa fa-check text-mint text-sm"></i>
                    </div>
                    <p class="text-sm font-bold text-mint">${message}</p>
                </div>
            </div>
        `;
        chatContainer.insertAdjacentHTML('beforeend', successMessageHtml);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // æ ¸å¿ƒä¿®æ”¹ï¼šAPI è°ƒç”¨é€»è¾‘
    function getApiConfig() {
        const selectedModel = modelSelect.value;
        console.log("44444444" , selectedModel, modelSelect.value)
        return {
            url: 'http://localhost:5000/api/chat/completions',
            model: selectedModel,
            temperature: parseFloat(temperatureSlider.value),
            max_tokens: parseInt(maxTokensSelect.value.split('ï¼ˆ')[0]),
            system_prompt: systemPrompt.value.trim()
        };
    }

    function renderUserMessage(content) {
        const userMessageHtml = `
            <div class="chat-bubble-user">
                <div class="flex items-start gap-4">
                    <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center">
                        <i class="fa fa-user text-primary text-sm"></i>
                    </div>
                    <p class="text-sm font-bold">${escapeHtml(content)}</p>
                </div>
            </div>
        `;
        chatContainer.insertAdjacentHTML('beforeend', userMessageHtml);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function renderAiMessageStream() {
        const aiMessageDiv = document.createElement('div');
        aiMessageDiv.className = 'chat-bubble-ai';
        aiMessageDiv.innerHTML = `
            <div class="flex items-start gap-4">
                <div class="w-8 h-8 rounded-full bg-secondary/20 flex items-center justify-center animate-bounce-slow">
                    <i class="fa fa-robot text-secondary text-sm"></i>
                </div>
                <p class="text-sm ai-content font-bold">æ­£åœ¨æ€è€ƒing... ğŸ¤”</p>
            </div>
        `;
        chatContainer.appendChild(aiMessageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        const contentElement = aiMessageDiv.querySelector('.ai-content');
        return { aiMessageDiv, contentElement };
    }

    async function callOllamaApi(userContent) {
        const { url, model, temperature, max_tokens, system_prompt } = getApiConfig();
        console.log("2222222", model)
        const { aiMessageDiv, contentElement } = renderAiMessageStream();

        try {
            const messages = [];
            if (system_prompt) {
                messages.push({ role: 'system', content: system_prompt });
            }
            messages.push({ role: 'user', content: userContent });

            const requestBody = {
                model: model,
                messages: messages,
                stream: true,
                use_context: selectedDocIds.length > 0,
                include_sources: false,
                ...(selectedDocIds.length > 0 && {
                    context_filter: { docs_ids: selectedDocIds }
                })
            };
            console.log("111111111111", JSON.stringify(requestBody))
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) throw new Error(`API å“åº”é”™è¯¯: ${response.status} ${response.statusText}`);

            const reader = response.body.getReader();
            const decoder = new TextDecoder('utf-8');
            let aiContent = '';

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                const chunk = decoder.decode(value);
                const lines = chunk.split('\n').filter(line => line.trim());

                for (const line of lines) {
                    try {
                        let dataStr = line.startsWith('data: ') ? line.slice(6).trim() : line.trim();
                        if (dataStr === '[DONE]') continue;
                        
                        const data = JSON.parse(dataStr);
                        let newContent = '';
                        
                        if (data.choices && data.choices.length > 0) {
                            newContent = data.choices[0].delta?.content || data.choices[0].message?.content || '';
                        } else if (data.response) {
                            newContent = data.response;
                        }

                        if (newContent) {
                            aiContent += newContent;
                            if (contentElement && contentElement.parentNode) {
                                contentElement.textContent = aiContent;
                                chatContainer.scrollTop = chatContainer.scrollHeight;
                            }
                        }
                    } catch (parseError) {
                        console.warn('è§£æé”™è¯¯:', parseError, 'è¡Œå†…å®¹:', line);
                    }
                }
            }

            if (!aiContent.trim()) {
                contentElement.textContent = 'å“å‘€ï¼Œæ²¡è·å–åˆ°æœ‰æ•ˆå›å¤å‘¢ ğŸ˜¥ï¼Œè¯·å†é—®ä¸€æ¬¡å§ï½';
            }

        } catch (error) {
            contentElement.innerHTML = `<span class="text-primary font-bold">âŒ è°ƒç”¨å¤±è´¥ï¼š${escapeHtml(error.message)}</span>`;
            console.error('Ollama API è°ƒç”¨é”™è¯¯ï¼š', error);
        }
    }

    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const message = userInput.value.trim();
        if (!message) return;

        userInput.value = '';
        renderUserMessage(message);
        await callOllamaApi(message);
    });

    function escapeHtml(unsafe) {
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    // ä¸»é¢˜åˆ‡æ¢
    themeBtn.addEventListener('click', () => {
        const icon = themeBtn.querySelector('i');
        if (icon.classList.contains('fa-moon-o')) {
            icon.classList.replace('fa-moon-o', 'fa-sun-o');
            document.body.classList.add('dark');
            document.body.classList.remove('bg-darker');
            document.body.classList.add('bg-dark-bg');
        } else {
            icon.classList.replace('fa-sun-o', 'fa-moon-o');
            document.body.classList.remove('dark');
            document.body.classList.add('bg-darker');
            document.body.classList.remove('bg-dark-bg');
        }
    });

    // åˆå§‹åŒ–ï¼šä¸ºç°æœ‰åˆ é™¤æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
    document.querySelectorAll('.delete-file-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            deleteFileFromKnowledgeBase(this, this.dataset.docId);
        });
    });

    async function initKnowledgeBase() {
        try {
            const response = await fetch("http://localhost:8001/v1/ingest/list");
            if (!response.ok) throw new Error("è·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥");
            console.error("åˆå§‹åŒ–çŸ¥è¯†åº“æ•°æ®ï¼š", response);
            const result = await response.json();
           
            if (result.data && Array.isArray(result.data)) {
                // æ¸…ç©ºç°æœ‰ç¤ºä¾‹æ•°æ®
                knowledgeBaseList.innerHTML = '';
                
                // æ·»åŠ æ‰€æœ‰å·²ä¸Šä¼ çš„æ–‡ä»¶
                result.data.forEach(doc => {
                    if (doc.doc_id && doc.doc_metadata?.file_name) {
                        addFileToKnowledgeBase(doc.doc_metadata.file_name, doc.doc_id);
                        selectedDocIds.push(doc.doc_id);
                    }
                });
            }
        } catch (error) {
            console.error("åˆå§‹åŒ–çŸ¥è¯†åº“å¤±è´¥ï¼š", error);
        }
    }

    window.addEventListener('load', initKnowledgeBase);
</script>
</body>
</html>